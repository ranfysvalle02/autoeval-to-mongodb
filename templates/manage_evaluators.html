<!DOCTYPE html>    
<html lang="en">    
<head>    
    <meta charset="UTF-8">    
    <title>Manage Evaluators</title>    
    <!-- Include Google Fonts -->    
    <link rel="preconnect" href="https://fonts.googleapis.com">    
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">    
    <!-- Include Font Awesome for Icons -->    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>    
    <!-- Embedded CSS Styles -->    
    <style>    
        /* Global Styles */    
        body {    
            margin: 0;    
            font-family: 'Roboto', sans-serif;    
            background-color: #f5f7fa;    
            color: #333;    
        }    
  
        header, footer {    
            background-color: #2c3e50;    
            color: white;    
            padding: 1em 0;    
            text-align: center;    
            position: sticky;    
            top: 0;    
            z-index: 1000;    
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);    
        }    
  
        header h1 {    
            margin: 0;    
            font-weight: normal;    
        }    
  
        main {    
            padding: 2em;    
            max-width: 1200px;    
            margin: 0 auto;    
        }    
  
        h2 {    
            color: #2c3e50;    
            margin-top: 1.5em;    
        }    
  
        h3 {    
            color: #34495e;    
            margin-top: 1em;    
        }    
  
        a {    
            color: #3498db;    
            text-decoration: none;    
        }    
  
        a:hover {    
            text-decoration: underline;    
        }    
  
        /* Navigation Styles */    
        nav {    
            background-color: #34495e;    
            padding: 0.5em 0;    
        }    
  
        nav ul {    
            list-style-type: none;    
            margin: 0;    
            padding: 0;    
            text-align: center;    
        }    
  
        nav ul li {    
            display: inline-block;    
            margin: 0 1em;    
        }    
  
        nav ul li a {    
            color: white;    
            font-weight: bold;    
        }    
  
        nav ul li a:hover {    
            text-decoration: underline;    
        }    
  
        /* Table Styles */    
        table {    
            width: 100%;    
            border-collapse: collapse;    
            margin-top: 1em;    
        }    
  
        table th, table td {    
            border: 1px solid #ddd;    
            padding: 0.5em;    
            vertical-align: top;    
        }    
  
        table th {    
            background-color: #f2f2f2;    
            text-align: left;    
        }    
  
        pre {    
            background-color: #f9f9f9;    
            padding: 0.5em;    
            border-radius: 4px;    
            overflow-x: auto;    
            max-width: 100%;    
        }    
  
        /* Button Styles */    
        .btn {    
            display: inline-block;    
            padding: 0.5em 1em;    
            margin: 0.2em 0;    
            background-color: #3498db;    
            color: white;    
            border: none;    
            border-radius: 4px;    
            cursor: pointer;    
            transition: background-color 0.3s ease, transform 0.1s ease;    
            text-decoration: none;    
            text-align: center;    
        }    
  
        .btn:hover {    
            background-color: #2980b9;    
            transform: translateY(-2px);    
        }    
  
        .error {    
            color: #e74c3c;    
            margin: 1em 0;    
        }    
  
        .success {    
            color: #27ae60;    
            margin: 1em 0;    
        }    
  
        .form-group {    
            margin-bottom: 1em;    
        }    
  
        .form-group label {    
            display: block;    
            font-weight: bold;    
            margin-bottom: 0.5em;    
        }    
  
        .form-group input[type="text"],    
        .form-group textarea,    
        .form-group select,    
        .form-group input[type="number"] {    
            width: 100%;    
            padding: 0.75em;    
            border: 1px solid #ccd1d9;    
            border-radius: 4px;    
            transition: border-color 0.3s ease, box-shadow 0.3s ease;    
            font-size: 1em;    
        }    
  
        .form-group input[type="text"]:focus,    
        .form-group textarea:focus,    
        .form-group select:focus,    
        .form-group input[type="number"]:focus {    
            border-color: #3498db;    
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);    
            outline: none;    
        }    
  
        .form-group textarea {    
            resize: vertical;    
        }    
  
        .form-actions {    
            margin-top: 1em;    
        }    
  
        /* Responsive Design */    
        @media (max-width: 768px) {    
            main {    
                padding: 1em;    
            }    
  
            table th, table td {    
                padding: 0.5em;    
            }    
        }    
    </style>    
</head>    
<body>    
    <header>    
        <h1>Manage Evaluators</h1>    
    </header>    
  
    <!-- Navigation Menu -->    
    <nav>    
        <ul>        
            <li><a href="{{ url_for('index') }}">Home</a></li>        
            <li><a href="{{ url_for('list_indexes') }}"> Atlas Search Indexes</a></li>        
            <li><a href="{{ url_for('manage_evaluators') }}">Manage Evaluators</a></li>    
        </ul>   
    </nav>    
  
    <main>    
        {% if error_message %}    
            <p class="error">{{ error_message }}</p>    
        {% endif %}    
        {% if success_message %}    
            <p class="success">{{ success_message }}</p>    
        {% endif %}    
  
        <h2>Create New Evaluator</h2>    
        <form method="post" action="{{ url_for('manage_evaluators') }}">    
            <input type="hidden" name="action" value="create_evaluator">    
            <div class="form-group">    
                <label for="name">Evaluator Name:</label>    
                <input type="text" id="name" name="name" required placeholder="Enter evaluator name">    
            </div>    
            <div class="form-group">    
                <label for="evaluator_type">Evaluator Type:</label>    
                <select id="evaluator_type" name="evaluator_type" required onchange="toggleEvaluatorFields()">    
                    <option value="">-- Select Evaluator Type --</option>    
                    {% for etype in evaluator_types %}    
                        <option value="{{ etype }}">{{ etype }}</option>    
                    {% endfor %}    
                </select>    
            </div>    
  
            <!-- Fields for LLMClassifier -->    
            <div id="llm_fields" style="display: none;">    
                <div class="form-group">    
                    <label for="prompt_template">Prompt Template:</label>    
                    <textarea id="prompt_template" name="prompt_template" placeholder="Enter prompt template"></textarea>    
                </div>    
                <div class="form-group">    
                    <label for="choice_scores">Choice Scores (JSON format):</label>    
                    <textarea id="choice_scores" name="choice_scores" placeholder='e.g., {"Yes": 1.0, "No": 0.0}'></textarea>    
                </div>    
                <div class="form-group">    
                    <label for="use_cot">Use Chain-of-Thought:</label>    
                    <input type="checkbox" id="use_cot" name="use_cot">    
                </div>    
                <div class="form-group">    
                    <label for="model_deployment_name">Model Deployment Name:</label>    
                    <select id="model_deployment_name" name="model_deployment_name">    
                        {% for deployment_name in deployment_names %}    
                            <option value="{{ deployment_name }}" {% if deployment_name == default_deployment %}selected{% endif %}>{{ deployment_name }}</option>    
                        {% endfor %}    
                    </select>    
                </div>    
                <div class="form-group">    
                    <label for="temperature">Temperature:</label>    
                    <input type="number" id="temperature" name="temperature" value="0.0" step="0.1" min="0.0" max="1.0">    
                </div>    
            </div>    
  
            <!-- Fields for FunctionEvaluator -->    
            <div id="function_fields" style="display: none;">    
                <div class="form-group">    
                    <label for="function_subtype">Function Subtype:</label>    
                    <select id="function_subtype" name="function_subtype" onchange="populateFunctionDefaults()">    
                        <option value="">-- Select Function Subtype --</option>    
                        {% for fsubtype in function_subtypes %}    
                            <option value="{{ fsubtype }}">{{ fsubtype }}</option>    
                        {% endfor %}    
                    </select>    
                </div>    
                <div class="form-group">    
                    <label for="parameters">Parameters (JSON format):</label>    
                    <textarea id="parameters" name="parameters" placeholder='Enter JSON for parameters (e.g., {"pattern": "\\d+"})'></textarea>    
                    <small>Provide necessary parameters for the selected function subtype.</small>    
                </div>    
            </div>    
  
            <div class="form-actions">    
                <button type="submit" class="btn">Create Evaluator</button>    
            </div>    
        </form>    
  
        <h2>Existing Evaluators</h2>    
        {% if evaluators %}    
            <table>    
                <thead>    
                    <tr>    
                        <th>Name</th>    
                        <th>Type</th>    
                        <th>Details</th>    
                        <th>Actions</th>    
                    </tr>    
                </thead>    
                <tbody>    
                    {% for evaluator in evaluators %}    
                        <tr>    
                            <td>{{ evaluator.name }}</td>    
                            <td>{{ evaluator.type }}</td>    
                            <td>    
                                {% if evaluator.type == 'LLMClassifier' %}    
                                    <strong>Choice Scores:</strong>    
                                    <pre>{{ evaluator.choice_scores_str }}</pre>    
                                    <strong>Prompt Template:</strong>    
                                    <pre>{{ evaluator.prompt_template }}</pre>    
                                    <strong>Use Chain-of-Thought:</strong> {{ 'Yes' if evaluator.use_cot else 'No' }}<br>    
                                    <strong>Model Deployment Name:</strong> {{ evaluator.model_deployment_name }}<br>    
                                    <strong>Temperature:</strong> {{ evaluator.temperature }}    
                                {% elif evaluator.type == 'FunctionEvaluator' %}    
                                    <strong>Function Subtype:</strong> {{ evaluator.function_subtype }}<br>    
                                    <strong>Parameters:</strong>    
                                    <pre>{{ evaluator.parameters_str }}</pre>    
                                {% endif %}    
                            </td>    
                            <td>    
                                <form method="post" action="{{ url_for('manage_evaluators') }}">    
                                    <input type="hidden" name="action" value="delete_evaluator">    
                                    <input type="hidden" name="evaluator_id" value="{{ evaluator._id }}">    
                                    <button type="submit" class="btn">Delete</button>    
                                </form>    
                            </td>    
                        </tr>    
                    {% endfor %}    
                </tbody>    
            </table>    
        {% else %}    
            <p>No evaluators found.</p>    
        {% endif %}    
    </main>    
  
    <footer>    
        <p>&copy; {{ current_year }} Your Company Name</p>    
    </footer>    
  
    <!-- JavaScript for Toggling Fields and Setting Default Examples -->    
    <script>    
        function toggleEvaluatorFields() {    
            var evaluatorType = document.getElementById('evaluator_type').value;    
            if (evaluatorType === 'LLMClassifier') {    
                document.getElementById('llm_fields').style.display = 'block';    
                document.getElementById('function_fields').style.display = 'none';    
  
                // Populate default values for LLMClassifier    
                populateLLMDefaults();    
  
            } else if (evaluatorType === 'FunctionEvaluator') {    
                document.getElementById('llm_fields').style.display = 'none';    
                document.getElementById('function_fields').style.display = 'block';    
  
                // Clear LLM fields    
                clearLLMFields();    
  
                // Since only 'regex_match' is available, set it by default    
                document.getElementById('function_subtype').value = 'regex_match';    
                populateFunctionDefaults();    
  
            } else {    
                document.getElementById('llm_fields').style.display = 'none';    
                document.getElementById('function_fields').style.display = 'none';    
  
                // Clear all fields    
                clearLLMFields();    
                clearFunctionFields();    
            }    
        }    
  
        function populateLLMDefaults() {  
            // Set default values for the evaluator  
            document.getElementById('name').value = 'Sentiment Analyzer';  
  
            var defaultPromptTemplate = `Given the following text:\n\n"{{ '{{' }}output{{ '}}' }}"\n\nPlease rate the sentiment of this text as 'positive', 'neutral', or 'negative'.`;  
            document.getElementById('prompt_template').value = defaultPromptTemplate;  

            var defaultChoiceScores = '{"positive": 1.0, "neutral": 0.5, "negative": 0.0}';  
            document.getElementById('choice_scores').value = defaultChoiceScores;  
  
            document.getElementById('use_cot').checked = false;  
        } 
  
        function populateFunctionDefaults() {    
            var functionSubtype = document.getElementById('function_subtype').value;    
  
            if (functionSubtype === 'regex_match') {    
                document.getElementById('name').value = 'Regex Match';    
  
                // Provide a default regex pattern    
                var defaultParameters = '{"pattern": "\\\\d+"}';    
                document.getElementById('parameters').value = defaultParameters;    
  
            } else {    
                // Clear parameters if other subtype    
                clearFunctionFields();    
            }    
        }    
  
        function clearLLMFields() {    
            document.getElementById('prompt_template').value = '';    
            document.getElementById('choice_scores').value = '';    
            document.getElementById('use_cot').checked = false;    
            document.getElementById('model_deployment_name').value = '{{ default_deployment }}';    
            document.getElementById('temperature').value = '0.0';    
        }    
  
        function clearFunctionFields() {    
            document.getElementById('function_subtype').value = '';    
            document.getElementById('parameters').value = '';    
        }    
  
        // Initial call to set fields if the page is reloaded with existing values    
        toggleEvaluatorFields();    
    </script>    
</body>    
</html>    