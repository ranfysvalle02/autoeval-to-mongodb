<!DOCTYPE html>    
<html lang="en">    
<head>    
    <meta charset="UTF-8">    
    <title>Manage Evaluators</title>    
     <!-- Include Google Fonts -->          
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">          
    <link href="https://fonts.googleapis.com/css2?family=Bitcount+Grid+Double:wght@100..900&display=swap" rel="stylesheet">

    <!-- Include Font Awesome for Icons -->    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>          
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"/>
      
</head>    
<body>    
    <header>  
        <div class="logo-container">  
            <img src="https://mongodb.gallerycdn.vsassets.io/extensions/mongodb/mongodb-vscode/1.13.3/1749482419080/Microsoft.VisualStudio.Services.Icons.Default" alt="MongoDB Logo">  
            <img src="https://res.cloudinary.com/ilaeweb/image/upload/c_fill,w_600,g_auto,q_auto,dpr_3.0,f_auto/ilae-climate-change-commission-brainleafsolus-colour2_D6D4D903-A7B7-9F1F-3758BEC807504AD1.png" alt="Additional Logo">  
            <h1>MDBEvalHub : Manage Evaluators</h1>  
        </div>  
    </header>    
  
    <!-- Navigation Menu -->    
    <nav>    
        <ul>        
            <li><a href="{{ url_for('index') }}">Home</a></li>        
            <li><a href="{{ url_for('list_indexes') }}"> Atlas Search Indexes</a></li>        
            <li><a href="{{ url_for('manage_evaluators') }}">Manage Evaluators</a></li>    
        </ul>   
    </nav>    
  
    <main>    
        <section>
        {% if error_message %}    
            <p class="error">{{ error_message }}</p>    
        {% endif %}    
        {% if success_message %}    
            <p class="success">{{ success_message }}</p>    
        {% endif %}    
  
        <h2>Create New Evaluator</h2>    
        <form method="post" action="{{ url_for('manage_evaluators') }}">    
            <input type="hidden" name="action" value="create_evaluator">    
            <div class="form-group">    
                <label for="name">Evaluator Name:</label>    
                <input type="text" id="name" name="name" required placeholder="Enter evaluator name">    
            </div>    
            <div class="form-group">    
                <label for="evaluator_type">Evaluator Type:</label>    
                <select id="evaluator_type" name="evaluator_type" required onchange="toggleEvaluatorFields()">    
                    <option value="">-- Select Evaluator Type --</option>    
                    {% for etype in evaluator_types %}    
                        <option value="{{ etype }}">{{ etype }}</option>    
                    {% endfor %}    
                </select>    
            </div>    
  
            <!-- Fields for LLMClassifier -->    
            <div id="llm_fields" style="display: none;">    
                <div class="form-group">    
                    <label for="prompt_template">Prompt Template:</label>    
                    <textarea id="prompt_template" name="prompt_template" placeholder="Enter prompt template"></textarea>    
                </div>    
                <div class="form-group">    
                    <label for="choice_scores">Choice Scores (JSON format):</label>    
                    <textarea id="choice_scores" name="choice_scores" placeholder='e.g., {"Yes": 1.0, "No": 0.0}'></textarea>    
                </div>    
                <div class="form-group">    
                    <label for="use_cot">Use Chain-of-Thought:</label>    
                    <input type="checkbox" id="use_cot" name="use_cot">    
                </div>    
                <div class="form-group">    
                    <label for="model_deployment_name">Model Deployment Name:</label>    
                    <select id="model_deployment_name" name="model_deployment_name">    
                        {% for deployment_name in deployment_names %}    
                            <option value="{{ deployment_name }}" {% if deployment_name == default_deployment %}selected{% endif %}>{{ deployment_name }}</option>    
                        {% endfor %}    
                    </select>    
                </div>    
                <div class="form-group">    
                    <label for="temperature">Temperature:</label>    
                    <input type="number" id="temperature" name="temperature" value="0.0" step="0.1" min="0.0" max="1.0">    
                </div>    
            </div>    
  
            <!-- Fields for FunctionEvaluator -->    
            <div id="function_fields" style="display: none;">    
                <div class="form-group">    
                    <label for="function_subtype">Function Subtype:</label>    
                    <select id="function_subtype" name="function_subtype" onchange="populateFunctionDefaults()">    
                        <option value="">-- Select Function Subtype --</option>    
                        {% for fsubtype in function_subtypes %}    
                            <option value="{{ fsubtype }}">{{ fsubtype }}</option>    
                        {% endfor %}    
                    </select>    
                </div>    
                <div class="form-group">    
                    <label for="parameters">Parameters (JSON format):</label>    
                    <textarea id="parameters" name="parameters" placeholder='Enter JSON for parameters (e.g., {"pattern": "\\d+"})'></textarea>    
                    <small>Provide necessary parameters for the selected function subtype.</small>    
                </div>    
            </div>    
  
            <div class="form-actions">    
                <button type="submit" class="btn">Create Evaluator</button>    
            </div>    
        </form>    
  
        <h2>Existing Evaluators</h2>    
        {% if evaluators %}    
            <table>    
                <thead>    
                    <tr>    
                        <th>Name</th>    
                        <th>Type</th>    
                        <th>Details</th>    
                        <th>Actions</th>    
                    </tr>    
                </thead>    
                <tbody>    
                    {% for evaluator in evaluators %}    
                        <tr>    
                            <td>{{ evaluator.name }}</td>    
                            <td>{{ evaluator.type }}</td>    
                            <td>    
                                {% if evaluator.type == 'LLMClassifier' %}    
                                    <strong>Choice Scores:</strong>    
                                    <pre>{{ evaluator.choice_scores_str }}</pre>    
                                    <strong>Prompt Template:</strong>    
                                    <pre>{{ evaluator.prompt_template }}</pre>    
                                    <strong>Use Chain-of-Thought:</strong> {{ 'Yes' if evaluator.use_cot else 'No' }}<br>    
                                    <strong>Model Deployment Name:</strong> {{ evaluator.model_deployment_name }}<br>    
                                    <strong>Temperature:</strong> {{ evaluator.temperature }}    
                                {% elif evaluator.type == 'FunctionEvaluator' %}    
                                    <strong>Function Subtype:</strong> {{ evaluator.function_subtype }}<br>    
                                    <strong>Parameters:</strong>    
                                    <pre>{{ evaluator.parameters_str }}</pre>    
                                {% endif %}    
                            </td>    
                            <td>    
                                <form method="post" action="{{ url_for('manage_evaluators') }}">    
                                    <input type="hidden" name="action" value="delete_evaluator">    
                                    <input type="hidden" name="evaluator_id" value="{{ evaluator._id }}">    
                                    <button type="submit" class="btn">Delete</button>    
                                </form>    
                            </td>    
                        </tr>    
                    {% endfor %}    
                </tbody>    
            </table>    
        {% else %}    
            <p>No evaluators found.</p>    
        {% endif %}   
        </section> 
    </main>    
  
    <footer>    

    </footer>    
  
    <!-- JavaScript for Toggling Fields and Setting Default Examples -->    
    <script>    
        function toggleEvaluatorFields() {    
            var evaluatorType = document.getElementById('evaluator_type').value;    
            if (evaluatorType === 'LLMClassifier') {    
                document.getElementById('llm_fields').style.display = 'block';    
                document.getElementById('function_fields').style.display = 'none';    
  
                // Populate default values for LLMClassifier    
                populateLLMDefaults();    
  
            } else if (evaluatorType === 'FunctionEvaluator') {    
                document.getElementById('llm_fields').style.display = 'none';    
                document.getElementById('function_fields').style.display = 'block';    
  
                // Clear LLM fields    
                clearLLMFields();    
  
                // Since only 'regex_match' is available, set it by default    
                document.getElementById('function_subtype').value = 'regex_match';    
                populateFunctionDefaults();    
  
            } else {    
                document.getElementById('llm_fields').style.display = 'none';    
                document.getElementById('function_fields').style.display = 'none';    
  
                // Clear all fields    
                clearLLMFields();    
                clearFunctionFields();    
            }    
        }    
  
        function populateLLMDefaults() {  
            // Set default values for the evaluator  
            document.getElementById('name').value = 'Sentiment Analyzer';  
  
            var defaultPromptTemplate = `Given the following text:\n\n"{{ '{{' }}output{{ '}}' }}"\n\nPlease rate the sentiment of this text as 'positive', 'neutral', or 'negative'.`;  
            document.getElementById('prompt_template').value = defaultPromptTemplate;  

            var defaultChoiceScores = '{"positive": 1.0, "neutral": 0.5, "negative": 0.0}';  
            document.getElementById('choice_scores').value = defaultChoiceScores;  
  
            document.getElementById('use_cot').checked = false;  
        } 
  
        function populateFunctionDefaults() {    
            var functionSubtype = document.getElementById('function_subtype').value;    
  
            if (functionSubtype === 'regex_match') {    
                document.getElementById('name').value = 'Regex Match';    
  
                // Provide a default regex pattern    
                var defaultParameters = '{"pattern": "\\\\d+"}';    
                document.getElementById('parameters').value = defaultParameters;    
  
            } else {    
                // Clear parameters if other subtype    
                clearFunctionFields();    
            }    
        }    
  
        function clearLLMFields() {    
            document.getElementById('prompt_template').value = '';    
            document.getElementById('choice_scores').value = '';    
            document.getElementById('use_cot').checked = false;    
            document.getElementById('model_deployment_name').value = '{{ default_deployment }}';    
            document.getElementById('temperature').value = '0.0';    
        }    
  
        function clearFunctionFields() {    
            document.getElementById('function_subtype').value = '';    
            document.getElementById('parameters').value = '';    
        }    
  
        // Initial call to set fields if the page is reloaded with existing values    
        toggleEvaluatorFields();    
    </script>    
</body>    
</html>    